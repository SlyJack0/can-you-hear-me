(function(){function l(){m||window.requestAnimationFrame(l);a.lastX=a.x;a.lastY=a.y;a.lastTileX=a.tileX;a.lastTileY=a.tileY;b.up?a.y-=1:b.down&&(a.y+=1);var g=d.collision(a.x,a.y);g&&(a.y=a.lastY);b.left?a.x-=1:b.right&&(a.x+=1);var c=d.collision(a.x,a.y);c&&(a.x=a.lastX);a.tileX=Math.floor(a.x/d.tileSize);a.tileY=Math.floor(a.y/d.tileSize);a.moving=b.up||b.down||b.left||b.right;c&&g?a.moving=!1:!c||b.up||b.down?!g||b.left||b.right||(a.moving=!1):a.moving=!1;a.moving&&!e.playing&&e.start();!a.moving&&
e.playing&&e.stop();r.setPosition(a.x,a.y);e.setPosition(a.x,a.y,0);f.listener.setPosition(a.x,a.y,0);a.tileX===a.lastTileX&&a.tileY===a.lastTileY||n.triggerSounds(d.getData(a.x,a.y));p.fillStyle="#000000";p.fillRect(0,0,h,k)}var h=window.innerWidth,k=window.innerHeight,c=document.getElementById("gameCanvas"),p=c.getContext("2d");c.width=h;c.height=k;window.AudioContext=window.AudioContext||window.webkitAudioContext||null;if(!AudioContext)throw Error("AudioContext not supported!");var f=new AudioContext,
c=f.createGain();c.connect(f.destination);var r=new Camera(0,0,h,k),e=new SoundSource(0,0,0,"sound/footsteps.wav",f,c);e.setLoop(!0);e.sound.volume.gain.value=0.2;var a={},d=new Map(function(){var b=d.getPlayerStartPosition();a={x:b.x,y:b.y,lastX:b.x,lastY:b.y,moving:!1}}),n=new SoundManager(f,c,d),b={up:!1,down:!1,left:!1,right:!1},q=function(a){37==a.keyCode?b.left=!0:38==a.keyCode?b.up=!0:39==a.keyCode?b.right=!0:40==a.keyCode&&(b.down=!0)};window.addEventListener("keydown",q);window.addEventListener("keyup",
function(a){37==a.keyCode?b.left=!1:38==a.keyCode?b.up=!1:39==a.keyCode?b.right=!1:40==a.keyCode&&(b.down=!1)});var m=!1;window.requestAnimationFrame(l);window.addEventListener("gameover",function(){console.log("Game over");m=!0;window.removeEventListener("keydown",q);n.stopAll()})})();